/*rST**************************************************************************

===================
MFExportFileHistory
===================

Columns
=======

+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
| Key                                                            | Name             | Data Type       | Max Length (Bytes)   | Nullability    | Identity   | Default       |
+================================================================+==================+=================+======================+================+============+===============+
|  Cluster Primary Key PK\_\_MFExport\_\_3214EC27979E5C19: ID    | ID               | int             | 4                    | NOT NULL       | 1 - 1      |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | FileExportRoot   | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | SubFolder\_1     | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | SubFolder\_2     | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | SubFolder\_3     | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | MultiDocFolder   | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | FileName         | nvarchar(256)   | 512                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | ClassID          | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | ObjID            | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | ObjType          | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | Version          | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | FileCheckSum     | nvarchar(100)   | 200                  | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | FileCount        | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | Created          | datetime        | 8                    | NULL allowed   |            | (getdate())   |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+
|                                                                | FileObjectID     | int             | 4                    | NULL allowed   |            |               |
+----------------------------------------------------------------+------------------+-----------------+----------------------+----------------+------------+---------------+

Indexes
=======

+----------------------------------------------------------------+------------------------------------------------------+---------------+----------+
| Key                                                            | Name                                                 | Key Columns   | Unique   |
+================================================================+======================================================+===============+==========+
|  Cluster Primary Key PK\_\_MFExport\_\_3214EC27979E5C19: ID    | PK\_\_MFExport\_\_3214EC27979E5C19 \| ID \| YES \|   | FIXME INDEXES |          |
+----------------------------------------------------------------+------------------------------------------------------+---------------+----------+

Used By
=======

- spMFExportFiles


Changelog
=========

==========  =========  ========================================================
Date        Author     Description
----------  ---------  --------------------------------------------------------
2019-09-07  JC         Added documentation
==========  =========  ========================================================

**rST*************************************************************************/
GO

PRINT SPACE(5) + QUOTENAME(@@SERVERNAME) + '.' + QUOTENAME(DB_NAME()) + '.[dbo].[MFExportFileHistory]';

GO

SET NOCOUNT ON;
EXEC [setup].[spMFSQLObjectsControl] @SchemaName = N'dbo'
								   , @ObjectName = N'MFExportFileHistory' -- nvarchar(100)
								   , @Object_Release = '4.2.7.46'		   -- varchar(50)
								   , @UpdateFlag = 2;
-- smallint
GO
/*------------------------------------------------------------------------------------------------
	Author: leRoux Cilliers, Laminin Solutions
	Create date: 2017-09
	Database: 
	Description: MFExportFileHistory table records for files exported from M-Files
------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------
  MODIFICATION HISTORY
  ====================
 	DATE			NAME		DESCRIPTION
	2018-6-29		lc			Add Column for MultiDocFolder
	2018-9-27		lc			Add script to alter column if missing
	2019-2-22		lc			Increase size of column for filename
------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------
  USAGE:
  =====
  Select * from MFExportFileHistory
  
--DROP TABLE dbo.[MFExportFileHistory]
-----------------------------------------------------------------------------------------------*/




IF NOT EXISTS (	  SELECT [name]
				  FROM	 [sys].[tables]
				  WHERE	 [name] = 'MFExportFileHistory'
						 AND SCHEMA_NAME([schema_id]) = 'dbo'
			  )
	BEGIN




CREATE TABLE MFExportFileHistory
(ID INT IDENTITY PRIMARY key
,FileExportRoot NVARCHAR(100) 
,SubFolder_1 NVARCHAR(100) 
,SubFolder_2 NVARCHAR(100) 
,SubFolder_3 NVARCHAR(100) 
,MultiDocFolder NVARCHAR(100)
,FileName NVARCHAR(256)
,ClassID INT 
,ObjID int
,ObjType int
,Version int
,[FileCheckSum] NVARCHAR(100)
,FileCount INT
,Created DATETIME DEFAULT (GETDATE())
)


	END



GO
--Table modifications #############################################################################################################################

/*	
	Effective Version: 4.2.5.43
	MultiDocFolder is introoduced in this version
*/
IF NOT EXISTS (	  SELECT	1
				  FROM		[INFORMATION_SCHEMA].[COLUMNS] AS [c]
				  WHERE		[c].[TABLE_NAME] = 'MFExportFileHistory'
							AND [c].[COLUMN_NAME] = 'MultiDocFolder'
			  )
	BEGIN
		ALTER TABLE dbo.[MFExportFileHistory] ADD [MultiDocFolder] NVARCHAR(500)

		PRINT SPACE(10) + '... Column [MultiDocFolder]: added';

	END


	GO 

	IF  NOT EXISTS(SELECT 1 FROM [INFORMATION_SCHEMA].[COLUMNS] 
		WHERE [TABLE_NAME] = 'MFExportFileHistory'
		AND [COLUMN_NAME] = 'FileObjectID'
		
		)
BEGIN
	ALTER TABLE MFExportFileHistory ADD FileObjectID INT;
	PRINT SPACE(10) + '... Column Message: Added FileObjectID Column';
END

GO
--INDEXES #############################################################################################################################


