/*rST**************************************************************************

=========================
MFObjectTypeToClassObject
=========================

Columns
=======

+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
| Key                                                                                                                                               | Name                     | Data Type      | Max Length (Bytes)   | Nullability    | Identity   |
+===================================================================================================================================================+==========================+================+======================+================+============+
|                                                                                                                                                   | ID                       | int            | 4                    | NOT NULL       | 1 - 1      |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|  Cluster Primary Key PK\_\_MFObject\_\_47BA7FEEAE9E2140: ObjectType\_ID\ *ID*\ MFID \  Indexes FKIX\_MFObjectTypeToClassObject\_ObjectType\_ID    | ObjectType\_ID           | int            | 4                    | NOT NULL       |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|  Cluster Primary Key PK\_\_MFObject\_\_47BA7FEEAE9E2140: ObjectType\_ID\ *ID*\ MFID \  Indexes FKIX\_MFObjectTypeToClassObject\_Class\_ID         | Class\_ID                | int            | 4                    | NOT NULL       |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|  Cluster Primary Key PK\_\_MFObject\_\_47BA7FEEAE9E2140: ObjectType\_ID\ *ID*\ MFID                                                               | Object\_MFID             | int            | 4                    | NOT NULL       |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|                                                                                                                                                   | Object\_LastModifiedBy   | varchar(100)   | 100                  | NULL allowed   |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|                                                                                                                                                   | Object\_LastModified     | datetime       | 8                    | NULL allowed   |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+
|                                                                                                                                                   | Object\_Deleted          | bit            | 1                    | NULL allowed   |            |
+---------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------+----------------+----------------------+----------------+------------+

Indexes
=======

+----------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+----------+
| Key                                                                                    | Name                                                                                                                                                                                                                                        | Key Columns   | Unique   |
+========================================================================================+=============================================================================================================================================================================================================================================+===============+==========+
|  Cluster Primary Key PK\_\_MFObject\_\_47BA7FEEAE9E2140: ObjectType\_ID\ *ID*\ MFID    | PK\_\_MFObject\_\_47BA7FEEAE9E2140 \| ObjectType\_ID, Class\_ID, Object\_MFID \| YES \| \| \| FKIX\_MFObjectTypeToClassObject\_Class\_ID \| Class\_ID \| \| \| \| FKIX\_MFObjectTypeToClassObject\_ObjectType\_ID \| ObjectType\_ID \| \|   | FIXME INDEXES |          |
+----------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+----------+

Used By
=======

- MFvwObjectTypeSummary
- spMFObjectTypeUpdateClassIndex


Changelog
=========

==========  =========  ========================================================
Date        Author     Description
----------  ---------  --------------------------------------------------------
2019-09-07  JC         Added documentation
==========  =========  ========================================================

**rST*************************************************************************/

SET NOCOUNT ON; 
GO
/*------------------------------------------------------------------------------------------------
	Author: leRoux Cilliers, Laminin Solutions
	Create date: 2016-04
	Database: {Database}
	Description:Object Type to Class Object Table 
	This is a special table for indexing all the class tables included in app accross all object types.
	This table is updated using the spMFObjectTypeUpdateClassIndex procedure
------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------
  MODIFICATION HISTORY
  ====================
 	DATE			NAME		DESCRIPTION
	YYYY-MM-DD		{Author}	{Comment}
------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------
  USAGE:
  =====
  Select * from 
  
-----------------------------------------------------------------------------------------------*/


GO

PRINT SPACE(5) + QUOTENAME(@@SERVERNAME) + '.' + QUOTENAME(DB_NAME())
    + '.[dbo].[MFObjectTypeToClassObject]';

GO
SET NOCOUNT ON 
EXEC setup.[spMFSQLObjectsControl] @SchemaName = N'dbo', @ObjectName = N'MFObjectTypeToClassObject', -- nvarchar(100)
    @Object_Release = '2.0.2.4', -- varchar(50)
    @UpdateFlag = 2 -- smallint
GO

IF EXISTS ( SELECT  name
            FROM    sys.tables
            WHERE   name = 'MFObjectTypeToClassObject'
                    AND SCHEMA_NAME(schema_id) = 'dbo' )
    BEGIN

        IF EXISTS ( SELECT  *
                    FROM    sys.foreign_keys
                    WHERE   parent_object_id = OBJECT_ID(N'dbo.MFObjectTypeToClassObject') )
            BEGIN
                ALTER TABLE MFObjectTypeToClassObject
                DROP CONSTRAINT FK_ObjectTypeToClassIndex_Class_ID, FK_ObjectTypeToClassIndex_ObjectType_ID;
            END;

        DROP TABLE MFObjectTypeToClassObject;
    END;

CREATE TABLE [dbo].[MFObjectTypeToClassObject]
    (
      [ID] INT IDENTITY(1, 1)
               NOT NULL ,
      ObjectType_ID INT NOT NULL ,
      Class_ID INT NOT NULL ,
      Object_MFID INT NOT null ,
      Object_LastModifiedBy VARCHAR(100) ,
      Object_LastModified DATETIME ,
      Object_Deleted BIT ,
      PRIMARY KEY ( [ObjectType_ID],[Class_ID],[Object_MFID] ) 
     
    );
GO

PRINT SPACE(10) + '... Table: created';

GO
