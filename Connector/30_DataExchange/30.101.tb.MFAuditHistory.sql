/*rST**************************************************************************

==============
MFAuditHistory
==============

Columns
=======

+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
| Key                                                                               | Name         | Data Type      | Max Length (Bytes)   | Nullability    | Identity   |
+===================================================================================+==============+================+======================+================+============+
|  Cluster Primary Key PK\_\_MFAuditH\_\_3214EC2738820C3F: ID                       | ID           | int            | 4                    | NOT NULL       | 1 - 1      |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | RecID        | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | SessionID    | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | TranDate     | datetime       | 8                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|  Indexes idx\_AuditHistory\_ObjType\_ObjID                                        | ObjectType   | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|  Indexes idx\_AuditHistory\_Class\_Flag                                           | Class        | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|  Indexes idx\_AuditHistory\_Class\_Flag idx\_AuditHistory\_ObjType\_ObjID \ (2)   | ObjID        | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | MFVersion    | smallint       | 2                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | StatusFlag   | smallint       | 2                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | StatusName   | varchar(100)   | 100                  | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+
|                                                                                   | UpdateFlag   | int            | 4                    | NULL allowed   |            |
+-----------------------------------------------------------------------------------+--------------+----------------+----------------------+----------------+------------+

Indexes
=======

+----------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+----------+
| Key                                                            | Name                                                                                                                                                                               | Key Columns   | Unique   |
+================================================================+====================================================================================================================================================================================+===============+==========+
|  Cluster Primary Key PK\_\_MFAuditH\_\_3214EC2738820C3F: ID    | PK\_\_MFAuditH\_\_3214EC2738820C3F \| ID \| YES \| \| \| idx\_AuditHistory\_Class\_Flag \| Class, ObjID \| \| \| \| idx\_AuditHistory\_ObjType\_ObjID \| ObjectType, ObjID \| \|   | FIXME INDEXES |          |
+----------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+----------+

Used By
=======

- MFvwAuditSummary
- MFvwLogTableStats
- spMFClassTableStats
- spMFDeleteHistory
- spMFLogTableStats
- spMFTableAudit
- spMFUpdateItemByItem
- spMFUpdateMFilesToMFSQL
- spMFUpdateTable
- spMFUpdateTableinBatches


Changelog
=========

==========  =========  ========================================================
Date        Author     Description
----------  ---------  --------------------------------------------------------
2019-09-07  JC         Added documentation
==========  =========  ========================================================

**rST*************************************************************************/

SET NOCOUNT ON; 
GO
/*------------------------------------------------------------------------------------------------
	Author: leRoux Cilliers, Laminin Solutions
	Create date: 2016-05
	Database: 
	Description: Audit history of comparison between M-Files and SQL
------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------
  MODIFICATION HISTORY
  ====================
 	DATE			NAME		DESCRIPTION
	YYYY-MM-DD		{Author}	{Comment}
------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------
  USAGE:
  =====
  Select * from MFAuditHistory
  drop table mfaudithistory
-----------------------------------------------------------------------------------------------*/


GO

PRINT SPACE(5) + QUOTENAME(@@SERVERNAME) + '.' + QUOTENAME(DB_NAME())
    + '.[dbo].[MFAuditHistory]';

GO

SET NOCOUNT ON 
EXEC setup.[spMFSQLObjectsControl] @SchemaName = N'dbo', @ObjectName = N'MFAuditHistory', -- nvarchar(100)
    @Object_Release = '2.0.2.5', -- varchar(50)
    @UpdateFlag = 2 -- smallint
go

IF NOT EXISTS ( SELECT  name
                FROM    sys.tables
                WHERE   name = 'MFAuditHistory'
                        AND SCHEMA_NAME(schema_id) = 'dbo' )

    BEGIN
 
 PRINT SPACE(10)+ 'Table created';

CREATE TABLE MFAuditHistory
(ID INT IDENTITY PRIMARY KEY ,
RecID INT,
SessionID INT,
TranDate DATETIME,
ObjectType INT,
Class INT,
[ObjID] INT,
MFVersion smallint,
StatusFlag SMALLINT,
StatusName VARCHAR(100),
UpdateFlag int
)

CREATE INDEX idx_AuditHistory_ObjType_ObjID ON MFAuditHistory(ObjectType, [ObjID])
CREATE INDEX idx_AuditHistory_Class_Flag ON MFAuditHistory(Class, [ObjID])

END

GO

