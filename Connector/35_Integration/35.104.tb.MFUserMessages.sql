/*rST**************************************************************************

==============
MFUserMessages
==============

Columns
=======

+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
| Key                                              | Name                         | Data Type          | Max Length (Bytes)   | Nullability    | Identity   | Default       |
+==================================================+==============================+====================+======================+================+============+===============+
|  Cluster Primary Key pk\_MFUserMessagesID: ID    | ID                           | int                | 4                    | NOT NULL       | 1 - 1      |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | GUID                         | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | MX\_User\_ID                 | uniqueidentifier   | 16                   | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Class                        | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Class\_ID                    | int                | 4                    | NOT NULL       |            | ((-1))        |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Created                      | datetime           | 8                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Created\_by                  | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Created\_by\_ID              | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | MF\_Last\_Modified           | datetime           | 8                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | MF\_Last\_Modified\_by       | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | MF\_Last\_Modified\_by\_ID   | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_Class\_Table          | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_Count                 | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_Message               | nvarchar(4000)     | 8000                 | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_Process\_Batch        | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_User                  | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Mfsql\_User\_ID              | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Name\_Or\_Title              | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Single\_File                 | bit                | 1                    | NOT NULL       |            | ((0))         |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Workflow                     | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Workflow\_ID                 | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | State                        | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | State\_ID                    | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | LastModified                 | datetime           | 8                    | NULL allowed   |            | (getdate())   |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Process\_ID                  | int                | 4                    | NULL allowed   |            | ((1))         |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | ObjID                        | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | ExternalID                   | nvarchar(100)      | 200                  | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | MFVersion                    | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | FileCount                    | int                | 4                    | NULL allowed   |            | ((0))         |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Deleted                      | bit                | 1                    | NULL allowed   |            | ((0))         |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+
|                                                  | Update\_ID                   | int                | 4                    | NULL allowed   |            |               |
+--------------------------------------------------+------------------------------+--------------------+----------------------+----------------+------------+---------------+

Indexes
=======

+--------------------------------------------------+------------------------+---------------+----------+
| Key                                              | Name                   | Key Columns   | Unique   |
+==================================================+========================+===============+==========+
|  Cluster Primary Key pk\_MFUserMessagesID: ID    | pk\_MFUserMessagesID   | ID            | YES      |
+--------------------------------------------------+------------------------+---------------+----------+

Used By
=======

- spMFInsertUserMessage


Changelog
=========

==========  =========  ========================================================
Date        Author     Description
----------  ---------  --------------------------------------------------------
2019-09-07  JC         Added documentation
==========  =========  ========================================================

**rST*************************************************************************/
PRINT SPACE(5) + QUOTENAME(@@SERVERNAME) + '.' + QUOTENAME(DB_NAME())
    + '.[dbo].[MFUserMessages]';

GO
SET NOCOUNT ON 
EXEC setup.[spMFSQLObjectsControl] @SchemaName = N'dbo', @ObjectName = N'MFUserMessages', -- nvarchar(100)
    @Object_Release = '3.1.2.38', -- varchar(50)
    @UpdateFlag = 2 -- smallint
GO
/*------------------------------------------------------------------------------------------------
	Author: leRoux Cilliers, Laminin Solutions
	Create date: 2017-03
	Database: 
	Description: Table for user messages 
	Used to set store the user messages generated by the MFProcessBatch Table
	

 
------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------
  MODIFICATION HISTORY
  ====================
 	DATE			NAME		DESCRIPTION
	2017-06-26		Arnie		-	Change field size for Message to NVARCHAR(4000)
		
------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------
  USAGE:
  =====
  Select * from [dbo].[MFUserMessages]

   DROP TABLE MFUserMessages 
-----------------------------------------------------------------------------------------------*/
GO
IF NOT EXISTS (	  SELECT [name]
				  FROM	 [sys].[tables]
				  WHERE	 [name] = 'MFUserMessages'
						 AND SCHEMA_NAME([schema_id]) = 'dbo'
			  )
	BEGIN


		CREATE TABLE [dbo].[MFUserMessages]
			(
				[ID] [INT] IDENTITY(1, 1) NOT NULL
			  , [ProcessBatch_ID] INT NULL
			  , [ClassTable] NVARCHAR(100)
			  , [OriginatingUser_ID] INT NULL
			  , [ItemCount] INT NULL
			  , [Created_on] DATETIME
					DEFAULT GETDATE() NOT NULL
			  , [Message] [NVARCHAR](4000) NULL
			)

        PRINT SPACE(10) + '... Table: created';
    END;
ELSE
    PRINT SPACE(10) + '... Table: exists';

GO
IF EXISTS(SELECT 1 FROM [INFORMATION_SCHEMA].[COLUMNS] 
		WHERE [TABLE_NAME] = 'MFUserMessages'
		AND [COLUMN_NAME] = 'Message'
		AND [CHARACTER_MAXIMUM_LENGTH] <> 4000
		)
BEGIN
	ALTER TABLE [dbo].[MFUserMessages] ALTER COLUMN [Message] NVARCHAR(4000)
	PRINT SPACE(10) + '... Column Message: updated column length to NVARCHAR(4000)';
END

GO